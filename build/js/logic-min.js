var logicjs={};logicjs._toJSON=function(c){var b=Kinetic.Type;var d={};d.attrs={};for(var a in c.attrs){var e=c.attrs[a];if(!b._isFunction(e)&&!b._isElement(e)&&!b._hasMethods(e)){d.attrs[a]=e}}d.nodeType=c.nodeType;d.shapeType=c.shapeType;d.oType=c.oType||"";return d};logicjs.Gate=Kinetic.Group.extend({init:function(a){this.oType="Gate";this._super(a);this.on("dragstart",function(){this.moveToTop()})},toJSON:function(){var c=logicjs._toJSON(this);c.inputs=[];var a=this.get(".input");for(var d=0;d<a.length;d++){var b=a[d];c.inputs.push(b.toJSON())}return c},load:function(b){this.attrs=b.attrs;var a=b.inputs;for(var c;c<b.inputs.length;c++){this.add(new logicjs.Anchor(b.inputs[c]))}}});logicjs.Anchor=Kinetic.Circle.extend({init:function(a){this.setDefaultAttrs({radius:5,stroke:"black",fill:"#ddd",strokeWidth:2,draggable:false});this.oType="Anchor";this._super(a)},toJSON:function(){return logicjs._toJSON(this)},load:function(a){this.attrs=a.attrs}});logicjs.And=logicjs.Gate.extend({init:function(a){this.setDefaultAttrs({draggable:true,x:0,y:0});this.oType="Gate";this._super(a);this.add(new Kinetic.Shape({drawFunc:function(b){b.fillStyle="white";b.strokeStyle="black";b.lineWidth=3;b.beginPath();b.moveTo(0,0);b.lineTo(30,0);b.arc(30,30,30,-Math.PI/2,Math.PI/2);b.moveTo(30,60);b.lineTo(0,60);b.lineTo(0,0);b.stroke();b.fill()},name:"shape",x:0,y:0}));this.add(new logicjs.Anchor({name:"input",x:0,y:20}));this.add(new logicjs.Anchor({name:"input",x:0,y:40}));this.add(new logicjs.Anchor({name:"output",x:60,y:30}))}});logicjs.Connector=Kinetic.Group.extend({init:function(a){var b=this;this.setDefaultAttrs({draggable:false,points:[0,0,10,10]});this.oType="Connector";this._super(a);this.add(new logicjs.Anchor({name:"anchor",x:b.getAttrs().points[0].x,y:b.getAttrs().points[0].y,draggable:true}));this.add(new logicjs.Anchor({name:"anchor",x:b.getAttrs().points[b.getAttrs().points.length-1].x,y:b.getAttrs().points[b.getAttrs().points.length-1].y,draggable:true}));this.add(new Kinetic.Line({name:"line",points:b.getAttrs().points,strokeWidth:2,stroke:"black"}));this.on("dragmove",function(c){b.drawLine()});this._getLine().on("click",function(){console.log("line click!")})},drawLine:function(){console.log(this);var d=this.get(".anchor");var c=[];for(var b=0;b<d.length;b++){c.push(d[b].getPosition())}console.log(c);var a=this.get(".line")[0];a.setPoints(c);a.moveToBottom();console.log(this.get(".line"))},_getLine:function(){return this;var a={};if(this.get(".line").length()==0){}else{return _.filter(this.getChildren(),function(b){return b.getName()=="line"})[0]}},toJSON:function(){var c=logicjs._toJSON(this);c.inputs=[];var a=this.get(".input");for(var d=0;d<a.length;d++){var b=a[d];c.inputs.push(b.toJSON())}return c},load:function(b){this.attrs=b.attrs;var a=b.inputs;for(var c;c<b.inputs.length;c++){this.add(new logicjs.Anchor(b.inputs[c]))}}});logicjs.Workflow=Kinetic.Stage.extend({init:function(a){this.setDefaultAttrs({});this.oType="Workflow";this._super(a);this.add(new Kinetic.Layer({id:"mainLayer"}));this.add(new Kinetic.Layer({id:"topLayer"}))},addGate:function(b){var a=new logicjs.And(b);var c=this.get("#mainLayer")[0];c.add(a);c.add(new logicjs.Connector({points:[73,70,340,23,450,60,500,20],stroke:"black",strokeWidth:2}));c.draw()}});